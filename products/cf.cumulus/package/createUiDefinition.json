{
    "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
    "handler": "Microsoft.Azure.CreateUIDef",
    "version": "0.1.2-preview",
    "parameters": {
        "basics": [
            {
                "name": "infoMessage",
                "type": "Microsoft.Common.InfoBox",
                "visible": true,
                "options": {
                    "icon": "Info",
                    "text": "Deploy an empty instance of CF.Cumulus ready for a small amount of post deployment configuration by the Cloud Formations product team."
                    }
            }
         ],
        "steps": [
            {
            "name": "config",
            "label": "Configuration",
            "elements": [
                {
                    "name": "infoMessage",
                    "type": "Microsoft.Common.InfoBox",
                    "visible": true,
                    "options": {
                        "icon": "Info",
                        "text": "Start configuring your CF.Cumulus product deployment. All default values can be used."
                        }
                },
                {
                    "name": "naming",
                    "type": "Microsoft.Common.Section",
                    "label": "Resource Naming",
                    "elements": [
                            {
                                "name": "computeDetails",
                                "type": "Microsoft.Common.TextBlock",
                                "visible": true,
                                "options": {
                                    "text": "Naming values to make up the Azure Resource names to be created and deployed for the CF.Cumulus product."
                                    }
                            },
                            {
                                "name": "orgName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Product Name Prefix Code",
                                "defaultValue": "cf",
                                "toolTip": "The naming prefix for all resources to be deployed.",
                                "constraints": {
                                    "required": true,
                                    "minLength": 2,
                                    "maxLength": 4,
                                    "regex": "^[a-zA-Z0-9]{2,4}$",
                                    "validationMessage": "Prefix must be 2-4 alphanumeric characters with no spaces or special characters."
                                }
                            },
                            {
                                "name": "domainName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Product Name",
                                "defaultValue": "cumulus",
                                "toolTip": "The optional middle part naming for all resources to be deployed. Suggested as the business unit, project or domain.",
                                "constraints": {
                                    "required": true,
                                    "minLength": 2,
                                    "maxLength": 8,
                                    "regex": "^[a-zA-Z0-9]{2,8}$",
                                    "validationMessage": "Prefix must be 2-8 alphanumeric characters with no spaces or special characters."
                                }
                            },
                            {
                                "name": "envName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Environment Name",
                                "defaultValue": "dev",
                                "toolTip": "The environment name abbreviation used for the deployment.",
                                "constraints": {
                                    "required": true,
                                    "minLength": 2,
                                    "maxLength": 4,
                                    "regex": "^[a-zA-Z0-9]{2,4}$",
                                    "validationMessage": "Prefix must be 2-4 alphanumeric characters with no spaces or special characters."
                                }
                            },
                            {
                                "name": "datalakeName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Data Lake Storage Name Suffix",
                                "defaultValue": "dls",
                                "toolTip": "Optional naming abbreviation for the Azure Data Lake Storage account.",
                                "constraints": {
                                    "required": true,
                                    "minLength": 2,
                                    "maxLength": 3,
                                    "regex": "^[a-zA-Z0-9]{2,3}$",
                                    "validationMessage": "Prefix must be 2-3 alphanumeric characters with no spaces or special characters."
                                }
                            },
                            {
                                "name": "functionStorageName",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Function App Storage Name Suffix",
                                "defaultValue": "st",
                                "toolTip": "Optional naming abbreviation for the Azure Storage account used to support the Azure Functions App.",
                                "constraints": {
                                    "required": true,
                                    "minLength": 2,
                                    "maxLength": 3,
                                    "regex": "^[a-zA-Z0-9]{2,3}$",
                                    "validationMessage": "Prefix must be 2-3 alphanumeric characters with no spaces or special characters."
                                }
                            },
                                                        {
                                "name": "uniqueIdentifier",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Numeric Identifier",
                                "defaultValue": "01",
                                "toolTip": "The numeric identifier for all resources as a naming suffix, used to differentiate between instances of resources.",
                                "constraints": {
                                    "required": true,
                                    "minLength": 2,
                                    "maxLength": 3,
                                    "regex": "^[0-9]{2,3}$",
                                    "validationMessage": "Identifier must be 2 or 3 numeric digits only."
                                }
                            }
                    ]
                },
                {
                    "name": "compute",
                    "type": "Microsoft.Common.Section",
                    "label": "Compute Tiers",
                    "elements": [
                            {
                                "name": "computeDetails",
                                "type": "Microsoft.Common.TextBlock",
                                "visible": true,
                                "options": {
                                    "text": "Set the compute tiers for Azure Databricks and the Azure App Service Plan required as part of the CF.Cumulus deployment."
                                    }
                            },
                            {
                                "name": "databricksSKU",
                                "type": "Microsoft.Common.DropDown",
                                "label": "Databricks SKU",
                                "defaultValue": ["Premium"],
                                "toolTip": "The product SKU for the Azure Databricks workspace.",
                                "constraints": 
                                { 
                                    "allowedValues": [
                                    {
                                        "label": "Premium",
                                        "description": "Using a Databricks Premium SKU and features. Recommended.",
                                        "value": "Premium"
                                    },
                                    {
                                        "label": "Standard",
                                        "description": "Using a Databricks Standard SKU and limited features.",
                                        "value": "Standard"
                                    }
                                    ],
                                    "required": true 
                                }
                            },
                            {
                                "name": "aspSKU",
                                "type": "Microsoft.Common.DropDown",
                                "label": "App Service Plan SKU",
                                "defaultValue": ["Consumption"],
                                "toolTip": "The product SKU for the App Service Plan used by the Azure Function App.",
                                "constraints": 
                                { 
                                    "allowedValues": [
                                    {
                                        "label": "Premium",
                                        "description": "Using a App Service Plan Premium SKU and features. Best for production environments.",
                                        "value": "premium"
                                    },
                                    {
                                        "label": "Consumption",
                                        "description": "Using a App Service Plan Premium SKU and features. Best for non-production environments.",
                                        "value": "consumption"
                                    }
                                    ],
                                    "required": true 
                            }
                        }           
                    ]
                },
                                {
                    "name": "sql",
                    "type": "Microsoft.Common.Section",
                    "label": "SQL Database",
                    "elements": [
                            {
                                "name": "sqlDetails",
                                "type": "Microsoft.Common.TextBlock",
                                "visible": true,
                                "options": {
                                    "text": "Pre-configure the SQL Database used for house the CF.Cumulus metadata."
                                    }
                            },    
                            {
                                "name": "deploySQLDacpac",
                                "type": "Microsoft.Common.CheckBox",
                                "label": "Deploy SQL DACPAC",
                                "defaultValue": false,
                                "toolTip": "Deploy the SQL DACPAC required for the metadata database objects."
                            },
                            {
                                "name": "myIPAddress",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Your External IP Address",
                                "defaultValue": "0.0.0.0",
                                "toolTip": "An external IP address that is allowed access to the Azure SQL Database, as part of the logical SQL instance Firewall Rules.",
                                "constraints": {
                                    "required": true,
                                    "regex": "^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])$",
                                    "validationMessage": "Please enter a valid IPv4 address (e.g., 123.45.67.89)."
                                }                                
                            },
                            {
                                "name": "allowAzureServices",
                                "type": "Microsoft.Common.CheckBox",
                                "label": "Allow Azure Services",
                                "defaultValue": true,
                                "toolTip": "Allow Azure services to access the Azure SQL Database, as part of the logical SQL instance Firewall Rules."
                            }
                    ]
                }
                ]
            },
            {
                "name": "tags",
                "label": "Tags",
                "elements": [
                    {
                        "name": "tagsByResource",
                        "type": "Microsoft.Common.TagsByResource",
                        "toolTip": "Assign tags to individual Azure Resources for cost management, organization, and governance.",
                        "resources": [
                            "Microsoft.DataFactory/factories",
                            "Microsoft.Sql/servers/databases",
                            "Microsoft.Sql/servers",
                            "Microsoft.Web/sites",
                            "Microsoft.Web/serverfarms",
                            "Microsoft.KeyVault/vaults",
                            "Microsoft.OperationalInsights/workspaces",
                            "Microsoft.Storage/storageAccounts",
                            "Microsoft.Compute/virtualMachines"
                        ]
                    }
                ]
            }
        ],
        "outputs": {
            "location": "[location()]",
            "orgName": "[steps('config').naming.orgName]",
            "domainName": "[steps('config').naming.domainName]",
            "envName": "[steps('config').naming.envName]",
            "datalakeName": "[steps('config').naming.datalakeName]",
            "functionStorageName": "[steps('config').naming.functionStorageName]",
            "uniqueIdentifier": "[steps('config').naming.uniqueIdentifier]",
            "databricksSKU": "[steps('config').compute.databricksSKU]",
            "aspSKU": "[steps('config').compute.aspSKU]",
            "deploySQLDacpac": "[steps('config').sql.deploySQLDacpac]",
            "myIPAddress": "[steps('config').sql.myIPAddress]",
            "allowAzureServices": "[steps('config').sql.allowAzureServices]"
        }
    }
}